<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BIN De-Duper</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1a2e;
      --border:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.60);
      --accent:#2563eb;
      --danger:#ef4444;
      --shadow:0 12px 30px rgba(0,0,0,.35);
      --r:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:var(--text);
      padding:18px;
    }
    .wrap{max-width:1100px;margin:0 auto}
    .top{
      display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;
      margin-bottom:12px;
    }
    .brand{
      display:flex;flex-direction:column;gap:3px;
    }
    .brand .h{
      font-weight:700;
      letter-spacing:.2px;
      font-size:16px;
    }
    .brand .s{
      color:var(--muted);
      font-size:12px;
      line-height:1.3;
    }
    .bar{
      display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;align-items:center;
    }
    button{
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:650;
      font-size:13px;
      cursor:pointer;
      transition:.12s ease;
      user-select:none;
    }
    button:hover{background:rgba(255,255,255,.10)}
    button:active{transform:translateY(1px)}
    button:disabled{opacity:.55;cursor:not-allowed}
    .primary{
      background:rgba(37,99,235,.25);
      border-color:rgba(37,99,235,.55);
    }
    .primary:hover{background:rgba(37,99,235,.34)}
    .danger{
      background:rgba(239,68,68,.18);
      border-color:rgba(239,68,68,.55);
    }
    .danger:hover{background:rgba(239,68,68,.24)}
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:520px;
    }
    .panelHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 12px 10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .panelHead .t{
      font-weight:700;
      font-size:13px;
      letter-spacing:.2px;
    }
    .panelHead .meta{
      color:var(--muted);
      font-size:12px;
      font-variant-numeric:tabular-nums;
      white-space:nowrap;
    }
    textarea{
      flex:1;
      width:100%;
      border:0;
      outline:none;
      resize:none;
      padding:12px;
      background:transparent;
      color:var(--text);
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      font-size:13px;
      line-height:1.35;
      font-variant-numeric:tabular-nums;
      white-space:pre;      /* preserve exact newlines */
      overflow:auto;
    }
    textarea::placeholder{color:rgba(255,255,255,.35)}
    .foot{
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.08);
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .hint{color:var(--muted);font-size:12px}
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.14);
      color:rgba(255,255,255,.92);
      padding:10px 12px;
      border-radius:12px;
      font-size:12px;
      display:none;
      max-width:min(92vw, 520px);
      backdrop-filter: blur(10px);
    }
    .toast.show{display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="h">BIN De-Duper</div>
        <div class="s">Dedupes by first 6 digits. Pads the starting token to 16 chars with “x”.</div>
      </div>
      <div class="bar">
        <button class="primary" id="btnProcess">Process</button>
        <button id="btnCopy" disabled>Copy Output</button>
        <button class="danger" id="btnClear">Clear</button>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <div class="panelHead">
          <div class="t">Input</div>
          <div class="meta"><span id="inLines">0</span> lines</div>
        </div>
        <textarea id="in" placeholder="Paste your lines here..."></textarea>
        <div class="foot">
          <div class="hint">Tip: Ctrl+Enter to process</div>
          <div class="hint">Blank/space-only lines are removed</div>
        </div>
      </div>

      <div class="panel">
        <div class="panelHead">
          <div class="t">Output</div>
          <div class="meta">
            kept <span id="kept">0</span> • removed <span id="removed">0</span>
          </div>
        </div>
        <textarea id="out" readonly placeholder="Output appears here..."></textarea>
        <div class="foot">
          <div class="hint">Only leading/trailing spaces are cleaned</div>
          <div class="hint">Newlines preserved</div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    (function(){
      const $in = document.getElementById('in');
      const $out = document.getElementById('out');
      const $btnProcess = document.getElementById('btnProcess');
      const $btnCopy = document.getElementById('btnCopy');
      const $btnClear = document.getElementById('btnClear');

      const $inLines = document.getElementById('inLines');
      const $kept = document.getElementById('kept');
      const $removed = document.getElementById('removed');
      const $toast = document.getElementById('toast');

      function toast(msg){
        $toast.textContent = msg;
        $toast.classList.add('show');
        clearTimeout($toast._t);
        $toast._t = setTimeout(()=> $toast.classList.remove('show'), 1800);
      }

      // Keep user's line breaks exactly (no "pretty rewrap").
      // Remove only lines that are empty or contain only spaces/tabs.
      function splitKeepNonBlankLines(text){
        const lines = text.split(/\r\n|\n|\r/);
        const out = [];
        for(const line of lines){
          if (line.trim().length === 0) continue;       // remove empty/space-only lines (your requirement)
          out.push(line.trim());                        // remove leading/trailing spaces ONLY
        }
        return out;
      }

      // De-dupe key: first 6 digits at the START of the line.
      function key6(line){
        const m = line.match(/^(\d{6})/);
        return m ? m[1] : null;
      }

      // Pad ONLY the starting token made from digits/x to 16 chars using 'x'.
      // Does NOT touch anything after (pipes, dates, etc).
      function padStartToken16(line){
        const m = line.match(/^([0-9xX]+)/);
        if(!m) return line;

        const token = m[1].replace(/X/g,'x');
        const rest = line.slice(m[1].length);

        if(token.length >= 16) return token + rest;
        return token + 'x'.repeat(16 - token.length) + rest;
      }

      function updateCounts(){
        $inLines.textContent = String(splitKeepNonBlankLines($in.value).length);
      }

      function process(){
        const lines = splitKeepNonBlankLines($in.value);

        const seen = new Set();
        const kept = [];
        let removed = 0;

        for(const line0 of lines){
          const line = line0; // already trimmed
          const k = key6(line);

          // If line doesn't start with 6 digits, we still keep it (but we still do padding if it begins with digits/x)
          if(!k){
            kept.push(padStartToken16(line));
            continue;
          }

          if(seen.has(k)){
            removed++;
            continue;
          }

          seen.add(k);
          kept.push(padStartToken16(line));
        }

        $out.value = kept.join("\n"); // exactly one line per input line, same format you pasted
        $kept.textContent = String(kept.length);
        $removed.textContent = String(removed);
        $btnCopy.disabled = kept.length === 0;

        toast(removed ? `Done: removed ${removed} duplicate(s).` : "Done: no duplicates found.");
      }

      async function copyOut(){
        const txt = $out.value;
        if(!txt.trim()){ toast("Output is empty."); return; }
        try{
          await navigator.clipboard.writeText(txt);
          toast("Copied.");
        }catch{
          $out.focus();
          $out.select();
          document.execCommand('copy');
          toast("Copied.");
        }
      }

      function clearAll(){
        $in.value = "";
        $out.value = "";
        $kept.textContent = "0";
        $removed.textContent = "0";
        $btnCopy.disabled = true;
        updateCounts();
        toast("Cleared.");
        $in.focus();
      }

      $btnProcess.addEventListener('click', process);
      $btnCopy.addEventListener('click', copyOut);
      $btnClear.addEventListener('click', clearAll);
      $in.addEventListener('input', updateCounts);

      document.addEventListener('keydown', (e)=>{
        const isMac = /MAC/i.test(navigator.platform);
        const mod = isMac ? e.metaKey : e.ctrlKey;
        if(mod && e.key === 'Enter'){ e.preventDefault(); process(); }
      });

      updateCounts();
    })();
  </script>
</body>
</html>
